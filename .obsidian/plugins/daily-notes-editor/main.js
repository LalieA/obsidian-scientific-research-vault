"use strict";var et=Object.defineProperty;var tt=(e,n,t)=>n in e?et(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var b=(e,n,t)=>(tt(e,typeof n!="symbol"?n+"":n,t),t);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=require("obsidian"),nt=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},it=nt(g);function I(){}function Te(e){return e()}function ye(){return Object.create(null)}function H(e){e.forEach(Te)}function pe(e){return typeof e=="function"}function Oe(e,n){return e!=e?n==n:e!==n||e&&typeof e=="object"||typeof e=="function"}function ot(e){return Object.keys(e).length===0}function Ae(e){return e&&pe(e.destroy)?e.destroy:I}function P(e,n){e.appendChild(n)}function W(e,n,t){e.insertBefore(n,t||null)}function A(e){e.parentNode&&e.parentNode.removeChild(e)}function C(e){return document.createElement(e)}function ge(e){return document.createTextNode(e)}function Y(){return ge(" ")}function rt(){return ge("")}function V(e,n,t,i){return e.addEventListener(n,t,i),()=>e.removeEventListener(n,t,i)}function F(e,n,t){t==null?e.removeAttribute(n):e.getAttribute(n)!==t&&e.setAttribute(n,t)}function st(e){return Array.from(e.childNodes)}function at(e,n){n=""+n,e.wholeText!==n&&(e.data=n)}let me;function j(e){me=e}const U=[],ce=[],oe=[],ve=[],lt=Promise.resolve();let de=!1;function ct(){de||(de=!0,lt.then(xe))}function ue(e){oe.push(e)}const le=new Set;let ee=0;function xe(){const e=me;do{for(;ee<U.length;){const n=U[ee];ee++,j(n),dt(n.$$)}for(j(null),U.length=0,ee=0;ce.length;)ce.pop()();for(let n=0;n<oe.length;n+=1){const t=oe[n];le.has(t)||(le.add(t),t())}oe.length=0}while(U.length);for(;ve.length;)ve.pop()();de=!1,le.clear(),j(e)}function dt(e){if(e.fragment!==null){e.update(),H(e.before_update);const n=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,n),e.after_update.forEach(ue)}}const re=new Set;let x;function ut(){x={r:0,c:[],p:x}}function ft(){x.r||H(x.c),x=x.p}function ae(e,n){e&&e.i&&(re.delete(e),e.i(n))}function we(e,n,t,i){if(e&&e.o){if(re.has(e))return;re.add(e),x.c.push(()=>{re.delete(e),i&&(t&&e.d(1),i())}),e.o(n)}else i&&i()}function ht(e,n){we(e,1,1,()=>{n.delete(e.key)})}function pt(e,n,t,i,o,r,s,a,h,l,d,f){let u=e.length,m=r.length,v=u;const _={};for(;v--;)_[e[v].key]=v;const w=[],c=new Map,p=new Map;for(v=m;v--;){const E=f(o,r,v),S=t(E);let D=s.get(S);D?i&&D.p(E,n):(D=l(S,E),D.c()),c.set(S,w[v]=D),S in _&&p.set(S,Math.abs(v-_[S]))}const k=new Set,T=new Set;function O(E){ae(E,1),E.m(a,d),s.set(E.key,E),d=E.first,m--}for(;u&&m;){const E=w[m-1],S=e[u-1],D=E.key,L=S.key;E===S?(d=E.first,u--,m--):c.has(L)?!s.has(D)||k.has(D)?O(E):T.has(L)?u--:p.get(D)>p.get(L)?(T.add(D),O(E)):(k.add(L),u--):(h(S,s),u--)}for(;u--;){const E=e[u];c.has(E.key)||h(E,s)}for(;m;)O(w[m-1]);return w}function gt(e){e&&e.c()}function Ie(e,n,t,i){const{fragment:o,after_update:r}=e.$$;o&&o.m(n,t),i||ue(()=>{const s=e.$$.on_mount.map(Te).filter(pe);e.$$.on_destroy?e.$$.on_destroy.push(...s):H(s),e.$$.on_mount=[]}),r.forEach(ue)}function He(e,n){const t=e.$$;t.fragment!==null&&(H(t.on_destroy),t.fragment&&t.fragment.d(n),t.on_destroy=t.fragment=null,t.ctx=[])}function mt(e,n){e.$$.dirty[0]===-1&&(U.push(e),ct(),e.$$.dirty.fill(0)),e.$$.dirty[n/31|0]|=1<<n%31}function We(e,n,t,i,o,r,s,a=[-1]){const h=me;j(e);const l=e.$$={fragment:null,ctx:[],props:r,update:I,not_equal:o,bound:ye(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:ye(),dirty:a,skip_bound:!1,root:n.target||h.$$.root};s&&s(l.root);let d=!1;if(l.ctx=t?t(e,n.props||{},(f,u,...m)=>{const v=m.length?m[0]:u;return l.ctx&&o(l.ctx[f],l.ctx[f]=v)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](v),d&&mt(e,f)),u}):[],l.update(),d=!0,H(l.before_update),l.fragment=i?i(l.ctx):!1,n.target){if(n.hydrate){const f=st(n.target);l.fragment&&l.fragment.l(f),f.forEach(A)}else l.fragment&&l.fragment.c();n.intro&&ae(e.$$.fragment),Ie(e,n.target,n.anchor,n.customElement),xe()}j(h)}class Ye{$destroy(){He(this,1),this.$destroy=I}$on(n,t){if(!pe(t))return I;const i=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return i.push(t),()=>{const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}$set(n){this.$$set&&!ot(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}function wt(e,n,t,i){function o(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(d){try{l(i.next(d))}catch(f){s(f)}}function h(d){try{l(i.throw(d))}catch(f){s(f)}}function l(d){d.done?r(d.value):o(d.value).then(a,h)}l((i=i.apply(e,n||[])).next())})}const te=new WeakMap;function _e(e){return e.containerEl.matches(".dn-editor.dn-leaf-view .workspace-leaf")}function yt(e){const n=[];for(let t=0;t<e;t++)n.push((16*Math.random()|0).toString(16));return n.join("")}function vt(e){const n=function(){return Object.setPrototypeOf(new g.Component,new.target.prototype)};return n.prototype=e.prototype,Object.setPrototypeOf(n,e)}const _t=(e,n,t,i)=>{let o=app.workspace.activeLeaf;o||(o=t),n||(n=o==null?void 0:o.containerEl);const r=new z(o,n,e,void 0,i);return[r.attachLeaf(),r]};var Le,Pe,Me,Ce;const se=class extends vt(g.HoverPopover){constructor(t,i,o,r,s){super();b(this,"onTarget");b(this,"setActive");b(this,"lockedOut");b(this,"abortController",this.addChild(new g.Component));b(this,"detaching",!1);b(this,"opening",!1);b(this,"rootSplit",new g.WorkspaceSplit(window.app.workspace,"vertical"));b(this,"isPinned",!0);b(this,"titleEl");b(this,"containerEl");b(this,"oldPopover",(Le=this.parent)==null?void 0:Le.DailyNoteEditor);b(this,"document",(Ce=(Me=(Pe=this.targetEl)==null?void 0:Pe.ownerDocument)!=null?Me:window.activeDocument)!=null?Ce:window.document);b(this,"id",yt(8));b(this,"bounce");b(this,"boundOnZoomOut");b(this,"originalPath");b(this,"originalLinkText");b(this,"hoverEl",this.document.defaultView.createDiv({cls:"dn-editor dn-leaf-view",attr:{id:"dn-"+this.id}}));this.targetEl=i,this.plugin=o,this.onShowCallback=s,r===void 0&&(r=300),this.onTarget=!0,this.parent=t,this.waitTime=r,this.state=g.PopoverState.Showing;const{hoverEl:a}=this;this.abortController.load(),this.timer=window.setTimeout(this.show.bind(this),r),this.setActive=this._setActive.bind(this),a&&a.addEventListener("mousedown",this.setActive),te.set(this.hoverEl,this),this.hoverEl.addClass("dn-editor"),this.containerEl=this.hoverEl.createDiv("dn-content"),this.buildWindowControls(),this.setInitialDimensions()}static activeWindows(){const t=[window],{floatingSplit:i}=app.workspace;if(i)for(const o of i.children)o.win&&t.push(o.win);return t}static containerForDocument(t){if(t!==document&&app.workspace.floatingSplit){for(const i of app.workspace.floatingSplit.children)if(i.doc===t)return i}return app.workspace.rootSplit}static activePopovers(){return this.activeWindows().flatMap(this.popoversForWindow)}static popoversForWindow(t){var i,o;return Array.prototype.slice.call((o=(i=t==null?void 0:t.document)==null?void 0:i.body.querySelectorAll(".dn-leaf-view"))!=null?o:[]).map(r=>te.get(r)).filter(r=>r)}static forLeaf(t){const i=t&&document.body.matchParent.call(t.containerEl,".dn-leaf-view");return i?te.get(i):void 0}static iteratePopoverLeaves(t,i){for(const o of this.activePopovers())if(o.rootSplit&&t.iterateLeaves(i,o.rootSplit))return!0;return!1}_setActive(t){t.preventDefault(),t.stopPropagation(),this.plugin.app.workspace.setActiveLeaf(this.leaves()[0],{focus:!0})}getDefaultMode(){return"source"}updateLeaves(){this.onTarget&&this.targetEl&&!this.document.contains(this.targetEl)&&(this.onTarget=!1,this.transition());let t=0;this.plugin.app.workspace.iterateLeaves(i=>{t++},this.rootSplit),t===0&&this.hide(),this.hoverEl.setAttribute("data-leaf-count",t.toString())}leaves(){const t=[];return this.plugin.app.workspace.iterateLeaves(i=>{t.push(i)},this.rootSplit),t}setInitialDimensions(){this.hoverEl.style.height="auto",this.hoverEl.style.width="100%"}transition(){this.shouldShow()?this.state===g.PopoverState.Hiding&&(this.state=g.PopoverState.Shown,clearTimeout(this.timer)):this.state===g.PopoverState.Showing?this.hide():this.state===g.PopoverState.Shown&&(this.state=g.PopoverState.Hiding,this.timer=window.setTimeout(()=>{this.shouldShow()?this.transition():this.hide()},this.waitTime))}buildWindowControls(){this.titleEl=this.document.defaultView.createDiv("popover-titlebar"),this.titleEl.createDiv("popover-title"),this.containerEl.prepend(this.titleEl)}attachLeaf(){this.rootSplit.getRoot=()=>this.plugin.app.workspace[this.document===document?"rootSplit":"floatingSplit"],this.rootSplit.getContainer=()=>se.containerForDocument(this.document),this.titleEl.insertAdjacentElement("afterend",this.rootSplit.containerEl);const t=this.plugin.app.workspace.createLeafInParent(this.rootSplit,0);return this.updateLeaves(),t}onload(){super.onload(),this.registerEvent(this.plugin.app.workspace.on("layout-change",this.updateLeaves,this)),this.registerEvent(app.workspace.on("layout-change",()=>{this.rootSplit.children.forEach((t,i)=>{t instanceof g.WorkspaceTabs&&this.rootSplit.replaceChild(i,t.children[0])})}))}onShow(){var s,a;setTimeout(()=>this.waitTime=600,600),(s=this.oldPopover)==null||s.hide(),this.oldPopover=null,this.hoverEl.toggleClass("is-new",!0),this.document.body.addEventListener("click",()=>{this.hoverEl.toggleClass("is-new",!1)},{once:!0,capture:!0}),this.parent&&(this.parent.DailyNoteEditor=this);const i=this.hoverEl.querySelector(".view-header");i==null||i.remove();const o=this.hoverEl.querySelector(".workspace-leaf");o&&this.hoverEl.appendChild(o);const r=this.hoverEl.querySelector(".inline-title");r&&r.remove(),(a=this.onShowCallback)==null||a.call(this),this.onShowCallback=void 0}detect(t){const{targetEl:i}=this;i&&(this.onTarget=t===i||i.contains(t))}shouldShow(){return this.shouldShowSelf()||this.shouldShowChild()}shouldShowChild(){return se.activePopovers().some(t=>t!==this&&t.targetEl&&this.hoverEl.contains(t.targetEl)?t.shouldShow():!1)}shouldShowSelf(){return!this.detaching&&!!(this.onTarget||this.state==g.PopoverState.Shown||this.document.querySelector(`body>.modal-container, body > #he${this.id} ~ .menu, body > #he${this.id} ~ .suggestion-container`))}show(){!this.targetEl||this.document.body.contains(this.targetEl)?(this.state=g.PopoverState.Shown,this.timer=0,this.targetEl.appendChild(this.hoverEl),this.onShow(),app.workspace.onLayoutChange(),this.load()):this.hide(),this.hoverEl.dataset.imgHeight&&this.hoverEl.dataset.imgWidth&&(this.hoverEl.style.height=parseFloat(this.hoverEl.dataset.imgHeight)+this.titleEl.offsetHeight+"px",this.hoverEl.style.width=parseFloat(this.hoverEl.dataset.imgWidth)+"px")}onHide(){var t;this.oldPopover=null,((t=this.parent)==null?void 0:t.DailyNoteEditor)===this&&(this.parent.DailyNoteEditor=null)}hide(){var i;if(this.onTarget=!1,this.detaching=!0,this.timer&&(clearTimeout(this.timer),this.timer=0),this.hoverEl.hide(),this.opening)return;const t=this.leaves();if(t.length)t[0].detach();else return this.parent=null,(i=this.abortController)==null||i.unload(),this.abortController=void 0,this.nativeHide()}nativeHide(){var o;const{hoverEl:t,targetEl:i}=this;if(this.state=g.PopoverState.Hidden,t.detach(),i){const r=i.matchParent(".dn-leaf-view");r&&((o=te.get(r))==null||o.transition())}this.onHide(),this.unload()}resolveLink(t,i){const o=g.parseLinktext(t);return o?this.plugin.app.metadataCache.getFirstLinkpathDest(o.path,i):null}async openLink(t,i,o,r){var v,_,w;let s=this.resolveLink(t,i);const a=g.parseLinktext(t);if(!s&&r){const c=this.plugin.app.fileManager.getNewFileParent(i);s=await this.plugin.app.fileManager.createNewMarkdownFile(c,a.path)}if(!s)return;const{viewRegistry:h}=this.plugin.app,l=h.typeByExtension[s.extension];if(!l||!h.viewByType[l])return;o=Object.assign(this.buildEphemeralState(s,a),o);const d=this.getDefaultMode(),f=this.buildState(d,o),u=await this.openFile(s,f,r),m=(v=u==null?void 0:u.view)==null?void 0:v.getViewType();if(m==="image"){((_=this.parent)==null?void 0:_.hasOwnProperty("editorEl"))&&this.parent.editorEl.hasClass("is-live-preview")&&(this.waitTime=3e3);const c=u.view.contentEl.querySelector("img");this.hoverEl.dataset.imgHeight=String(c.naturalHeight),this.hoverEl.dataset.imgWidth=String(c.naturalWidth),this.hoverEl.dataset.imgRatio=String(c.naturalWidth/c.naturalHeight)}else m==="pdf"&&(this.hoverEl.style.height="800px",this.hoverEl.style.width="600px");((w=f.state)==null?void 0:w.mode)==="source"&&this.whenShown(()=>{var c,p,k,T;g.requireApiVersion("1.0")&&((k=(p=(c=u==null?void 0:u.view)==null?void 0:c.editMode)==null?void 0:p.reinit)==null||k.call(p)),(T=u==null?void 0:u.view)==null||T.setEphemeralState(f.eState)})}whenShown(t){if(this.detaching)return;const i=this.onShowCallback;this.onShowCallback=()=>{this.detaching||(t(),typeof i=="function"&&i())},this.state===g.PopoverState.Shown&&(this.onShowCallback(),this.onShowCallback=void 0)}async openFile(t,i,o){if(this.detaching)return;const r=o!=null?o:this.attachLeaf();this.opening=!0;try{await r.openFile(t,i)}catch(s){console.error(s)}finally{this.opening=!1,this.detaching&&this.hide()}return this.plugin.app.workspace.setActiveLeaf(r),r}buildState(t,i){return{active:!1,state:{mode:"source"},eState:i}}buildEphemeralState(t,i){const o=this.plugin.app.metadataCache.getFileCache(t),r=o?g.resolveSubpath(o,(i==null?void 0:i.subpath)||""):void 0,s={subpath:i==null?void 0:i.subpath};return r&&(s.line=r.start.line,s.startLoc=r.start,s.endLoc=r.end||void 0),s}};let z=se;b(z,"activePopover");const kt={root:null,rootMargin:"0px",threshold:0,unobserveOnEnter:!1},ne=(e,n)=>new CustomEvent(e,{detail:n});function Re(e,n={}){const{root:t,rootMargin:i,threshold:o,unobserveOnEnter:r}=Object.assign(Object.assign({},kt),n);let s={x:void 0,y:void 0},a={vertical:void 0,horizontal:void 0};if(typeof IntersectionObserver<"u"&&e){const h=new IntersectionObserver((l,d)=>{l.forEach(f=>{s.y>f.boundingClientRect.y?a.vertical="up":a.vertical="down",s.x>f.boundingClientRect.x?a.horizontal="left":a.horizontal="right",s={y:f.boundingClientRect.y,x:f.boundingClientRect.x};const u={inView:f.isIntersecting,entry:f,scrollDirection:a,node:e,observer:d};e.dispatchEvent(ne("change",u)),f.isIntersecting?(e.dispatchEvent(ne("enter",u)),r&&d.unobserve(e)):e.dispatchEvent(ne("leave",u))})},{root:t,rootMargin:i,threshold:o});return setTimeout(()=>{e.dispatchEvent(ne("init",{observer:h,node:e}))},0),h.observe(e),{destroy(){h.unobserve(e)}}}}function ke(e){let n,t,i,o;return{c(){n=C("div"),t=ge(e[1]),F(n,"class","daily-note-title svelte-y39958"),F(n,"aria-hidden","true")},m(r,s){W(r,n,s),P(n,t),i||(o=V(n,"click",e[3]),i=!0)},p(r,s){s&2&&at(t,r[1])},d(r){r&&A(n),i=!1,o()}}}function bt(e){let n,t,i,o,r,s,a,h,l,d=e[1]&&ke(e);return{c(){n=C("div"),t=C("div"),d&&d.c(),i=Y(),o=C("div"),r=Y(),s=C("div"),F(o,"class","daily-note-editor"),F(o,"aria-label",e[1]),F(t,"class","daily-note svelte-y39958"),F(n,"class","daily-note-container"),F(n,"aria-label",a="dn-editor-"+e[2])},m(f,u){W(f,n,u),P(n,t),d&&d.m(t,null),P(t,i),P(t,o),e[9](o),P(n,r),P(n,s),h||(l=[Ae(Re.call(null,s,{rootMargin:"20%"})),V(s,"leave",e[4]),V(s,"enter",e[5])],h=!0)},p(f,[u]){f[1]?d?d.p(f,u):(d=ke(f),d.c(),d.m(t,i)):d&&(d.d(1),d=null),u&2&&F(o,"aria-label",f[1]),u&4&&a!==(a="dn-editor-"+f[2])&&F(n,"aria-label",a)},i:I,o:I,d(f){f&&A(n),d&&d.d(),e[9](null),h=!1,H(l)}}}function Nt(e){const n=[];for(let t=0;t<e;t++)n.push((16*Math.random()|0).toString(16));return n.join("")}function Et(e,n,t){let{file:i}=n,{plugin:o}=n,{leaf:r}=n,s,a,h=!1,l,d,f;function u(){i instanceof g.TFile&&(h||(t(1,a=i.basename),[d,f]=_t(o,s,r),d.setPinned(!0),d.openFile(i,{active:!1,state:{mode:"source"}}),h=!0))}function m(){i instanceof g.TFile&&(r?r.openFile(i):app.workspace.getLeaf(!1).openFile(i))}function v(c){const{scrollDirection:p}=c.detail;p.vertical==="up"&&(h=!1,f.hide())}function _(c){const{scrollDirection:p}=c.detail;p.vertical==="down"&&u()}function w(c){ce[c?"unshift":"push"](()=>{s=c,t(0,s)})}return e.$$set=c=>{"file"in c&&t(6,i=c.file),"plugin"in c&&t(7,o=c.plugin),"leaf"in c&&t(8,r=c.leaf)},e.$$.update=()=>{e.$$.dirty&1&&s&&(u(),t(2,l=Nt(8)))},[s,a,l,m,v,_,i,o,r,w]}class Dt extends Ye{constructor(n){super(),We(this,n,Et,bt,Oe,{file:6,plugin:7,leaf:8})}}var y={};Object.defineProperty(y,"__esModule",{value:!0});var N=it.default;const fe="YYYY-MM-DD",he="gggg-[W]ww",Ve="YYYY-MM",qe="YYYY-[Q]Q",Be="YYYY";function Q(e){var t,i;const n=window.app.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t[e])==null?void 0:i.enabled)}function Z(){var e,n,t,i;try{const{internalPlugins:o,plugins:r}=window.app;if(Q("daily")){const{format:l,folder:d,template:f}=((n=(e=r.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.daily)||{};return{format:l||fe,folder:(d==null?void 0:d.trim())||"",template:(f==null?void 0:f.trim())||""}}const{folder:s,format:a,template:h}=((i=(t=o.getPluginById("daily-notes"))==null?void 0:t.instance)==null?void 0:i.options)||{};return{format:a||fe,folder:(s==null?void 0:s.trim())||"",template:(h==null?void 0:h.trim())||""}}catch(o){console.info("No custom daily note settings found!",o)}}function G(){var e,n,t,i,o,r,s;try{const a=window.app.plugins,h=(e=a.getPlugin("calendar"))==null?void 0:e.options,l=(t=(n=a.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:t.weekly;if(Q("weekly"))return{format:l.format||he,folder:((i=l.folder)==null?void 0:i.trim())||"",template:((o=l.template)==null?void 0:o.trim())||""};const d=h||{};return{format:d.weeklyNoteFormat||he,folder:((r=d.weeklyNoteFolder)==null?void 0:r.trim())||"",template:((s=d.weeklyNoteTemplate)==null?void 0:s.trim())||""}}catch(a){console.info("No custom weekly note settings found!",a)}}function K(){var n,t,i,o;const e=window.app.plugins;try{const r=Q("monthly")&&((t=(n=e.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:t.monthly)||{};return{format:r.format||Ve,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom monthly note settings found!",r)}}function $(){var n,t,i,o;const e=window.app.plugins;try{const r=Q("quarterly")&&((t=(n=e.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:t.quarterly)||{};return{format:r.format||qe,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom quarterly note settings found!",r)}}function J(){var n,t,i,o;const e=window.app.plugins;try{const r=Q("yearly")&&((t=(n=e.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:t.yearly)||{};return{format:r.format||Be,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom yearly note settings found!",r)}}function Ue(...e){let n=[];for(let i=0,o=e.length;i<o;i++)n=n.concat(e[i].split("/"));const t=[];for(let i=0,o=n.length;i<o;i++){const r=n[i];!r||r==="."||t.push(r)}return n[0]===""&&t.unshift(""),t.join("/")}function St(e){let n=e.substring(e.lastIndexOf("/")+1);return n.lastIndexOf(".")!=-1&&(n=n.substring(0,n.lastIndexOf("."))),n}async function Ft(e){const n=e.replace(/\\/g,"/").split("/");if(n.pop(),n.length){const t=Ue(...n);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function X(e,n){n.endsWith(".md")||(n+=".md");const t=N.normalizePath(Ue(e,n));return await Ft(t),t}async function q(e){const{metadataCache:n,vault:t}=window.app,i=N.normalizePath(e);if(i==="/")return Promise.resolve(["",null]);try{const o=n.getFirstLinkpathDest(i,""),r=await t.cachedRead(o),s=window.app.foldManager.load(o);return[r,s]}catch(o){return console.error(`Failed to read the daily note template '${i}'`,o),new N.Notice("Failed to read the daily note template"),["",null]}}function M(e,n="day"){const t=e.clone().startOf(n).format();return`${n}-${t}`}function je(e){return e.replace(/\[[^\]]*\]/g,"")}function Lt(e,n){if(n==="week"){const t=je(e);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function B(e,n){return ze(e.basename,n)}function Pt(e,n){return ze(St(e),n)}function ze(e,n){const i={day:Z,week:G,month:K,quarter:$,year:J}[n]().format.split("/").pop(),o=window.moment(e,i,!0);if(!o.isValid())return null;if(Lt(i,n)&&n==="week"){const r=je(i);if(/w{1,2}/i.test(r))return window.moment(e,i.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return o}class Mt extends Error{}async function Qe(e){const n=window.app,{vault:t}=n,i=window.moment,{template:o,format:r,folder:s}=Z(),[a,h]=await q(o),l=e.format(r),d=await X(s,l);try{const f=await t.create(d,a.replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,i().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,m,v,_,w,c)=>{const p=i(),k=e.clone().set({hour:p.get("hour"),minute:p.get("minute"),second:p.get("second")});return v&&k.add(parseInt(_,10),w),c?k.format(c.substring(1).trim()):k.format(r)}).replace(/{{\s*yesterday\s*}}/gi,e.clone().subtract(1,"day").format(r)).replace(/{{\s*tomorrow\s*}}/gi,e.clone().add(1,"d").format(r)));return n.foldManager.save(f,h),f}catch(f){console.error(`Failed to create file: '${d}'`,f),new N.Notice("Unable to create new file.")}}function Ct(e,n){var t;return(t=n[M(e,"day")])!=null?t:null}function Tt(){const{vault:e}=window.app,{folder:n}=Z(),t=e.getAbstractFileByPath(N.normalizePath(n));if(!t)throw new Mt("Failed to find daily notes folder");const i={};return N.Vault.recurseChildren(t,o=>{if(o instanceof N.TFile){const r=B(o,"day");if(r){const s=M(r,"day");i[s]=o}}}),i}class Ot extends Error{}function At(){const{moment:e}=window;let n=e.localeData()._week.dow;const t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;n;)t.push(t.shift()),n--;return t}function xt(e){return At().indexOf(e.toLowerCase())}async function Ze(e){const{vault:n}=window.app,{template:t,format:i,folder:o}=G(),[r,s]=await q(t),a=e.format(i),h=await X(o,a);try{const l=await n.create(h,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,f,u,m,v,_)=>{const w=window.moment(),c=e.clone().set({hour:w.get("hour"),minute:w.get("minute"),second:w.get("second")});return u&&c.add(parseInt(m,10),v),_?c.format(_.substring(1).trim()):c.format(i)}).replace(/{{\s*title\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,f,u)=>{const m=xt(f);return e.weekday(m).format(u.trim())}));return window.app.foldManager.save(l,s),l}catch(l){console.error(`Failed to create file: '${h}'`,l),new N.Notice("Unable to create new file.")}}function It(e,n){var t;return(t=n[M(e,"week")])!=null?t:null}function Ht(){const e={};if(!Ke())return e;const{vault:n}=window.app,{folder:t}=G(),i=n.getAbstractFileByPath(N.normalizePath(t));if(!i)throw new Ot("Failed to find weekly notes folder");return N.Vault.recurseChildren(i,o=>{if(o instanceof N.TFile){const r=B(o,"week");if(r){const s=M(r,"week");e[s]=o}}}),e}class Wt extends Error{}async function Ge(e){const{vault:n}=window.app,{template:t,format:i,folder:o}=K(),[r,s]=await q(t),a=e.format(i),h=await X(o,a);try{const l=await n.create(h,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,f,u,m,v,_)=>{const w=window.moment(),c=e.clone().set({hour:w.get("hour"),minute:w.get("minute"),second:w.get("second")});return u&&c.add(parseInt(m,10),v),_?c.format(_.substring(1).trim()):c.format(i)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,s),l}catch(l){console.error(`Failed to create file: '${h}'`,l),new N.Notice("Unable to create new file.")}}function Yt(e,n){var t;return(t=n[M(e,"month")])!=null?t:null}function Rt(){const e={};if(!$e())return e;const{vault:n}=window.app,{folder:t}=K(),i=n.getAbstractFileByPath(N.normalizePath(t));if(!i)throw new Wt("Failed to find monthly notes folder");return N.Vault.recurseChildren(i,o=>{if(o instanceof N.TFile){const r=B(o,"month");if(r){const s=M(r,"month");e[s]=o}}}),e}class Vt extends Error{}async function qt(e){const{vault:n}=window.app,{template:t,format:i,folder:o}=$(),[r,s]=await q(t),a=e.format(i),h=await X(o,a);try{const l=await n.create(h,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,f,u,m,v,_)=>{const w=window.moment(),c=e.clone().set({hour:w.get("hour"),minute:w.get("minute"),second:w.get("second")});return u&&c.add(parseInt(m,10),v),_?c.format(_.substring(1).trim()):c.format(i)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,s),l}catch(l){console.error(`Failed to create file: '${h}'`,l),new N.Notice("Unable to create new file.")}}function Bt(e,n){var t;return(t=n[M(e,"quarter")])!=null?t:null}function Ut(){const e={};if(!Je())return e;const{vault:n}=window.app,{folder:t}=$(),i=n.getAbstractFileByPath(N.normalizePath(t));if(!i)throw new Vt("Failed to find quarterly notes folder");return N.Vault.recurseChildren(i,o=>{if(o instanceof N.TFile){const r=B(o,"quarter");if(r){const s=M(r,"quarter");e[s]=o}}}),e}class jt extends Error{}async function zt(e){const{vault:n}=window.app,{template:t,format:i,folder:o}=J(),[r,s]=await q(t),a=e.format(i),h=await X(o,a);try{const l=await n.create(h,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,f,u,m,v,_)=>{const w=window.moment(),c=e.clone().set({hour:w.get("hour"),minute:w.get("minute"),second:w.get("second")});return u&&c.add(parseInt(m,10),v),_?c.format(_.substring(1).trim()):c.format(i)}).replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a));return window.app.foldManager.save(l,s),l}catch(l){console.error(`Failed to create file: '${h}'`,l),new N.Notice("Unable to create new file.")}}function Qt(e,n){var t;return(t=n[M(e,"year")])!=null?t:null}function Zt(){const e={};if(!Xe())return e;const{vault:n}=window.app,{folder:t}=J(),i=n.getAbstractFileByPath(N.normalizePath(t));if(!i)throw new jt("Failed to find yearly notes folder");return N.Vault.recurseChildren(i,o=>{if(o instanceof N.TFile){const r=B(o,"year");if(r){const s=M(r,"year");e[s]=o}}}),e}function Gt(){var i,o;const{app:e}=window,n=e.internalPlugins.plugins["daily-notes"];if(n&&n.enabled)return!0;const t=e.plugins.getPlugin("periodic-notes");return t&&((o=(i=t.settings)==null?void 0:i.daily)==null?void 0:o.enabled)}function Ke(){var t,i;const{app:e}=window;if(e.plugins.getPlugin("calendar"))return!0;const n=e.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t.weekly)==null?void 0:i.enabled)}function $e(){var t,i;const{app:e}=window,n=e.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t.monthly)==null?void 0:i.enabled)}function Je(){var t,i;const{app:e}=window,n=e.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t.quarterly)==null?void 0:i.enabled)}function Xe(){var t,i;const{app:e}=window,n=e.plugins.getPlugin("periodic-notes");return n&&((i=(t=n.settings)==null?void 0:t.yearly)==null?void 0:i.enabled)}function Kt(e){const n={day:Z,week:G,month:K,quarter:$,year:J}[e];return n()}function $t(e,n){return{day:Qe,month:Ge,week:Ze}[e](n)}y.DEFAULT_DAILY_NOTE_FORMAT=fe;y.DEFAULT_MONTHLY_NOTE_FORMAT=Ve;y.DEFAULT_QUARTERLY_NOTE_FORMAT=qe;y.DEFAULT_WEEKLY_NOTE_FORMAT=he;y.DEFAULT_YEARLY_NOTE_FORMAT=Be;y.appHasDailyNotesPluginLoaded=Gt;y.appHasMonthlyNotesPluginLoaded=$e;y.appHasQuarterlyNotesPluginLoaded=Je;y.appHasWeeklyNotesPluginLoaded=Ke;y.appHasYearlyNotesPluginLoaded=Xe;var Jt=y.createDailyNote=Qe;y.createMonthlyNote=Ge;y.createPeriodicNote=$t;y.createQuarterlyNote=qt;y.createWeeklyNote=Ze;y.createYearlyNote=zt;var Xt=y.getAllDailyNotes=Tt;y.getAllMonthlyNotes=Rt;y.getAllQuarterlyNotes=Ut;y.getAllWeeklyNotes=Ht;y.getAllYearlyNotes=Zt;var en=y.getDailyNote=Ct;y.getDailyNoteSettings=Z;var be=y.getDateFromFile=B;y.getDateFromPath=Pt;y.getDateUID=M;y.getMonthlyNote=Yt;y.getMonthlyNoteSettings=K;y.getPeriodicNoteSettings=Kt;y.getQuarterlyNote=Bt;y.getQuarterlyNoteSettings=$;y.getTemplateInfo=q;y.getWeeklyNote=It;y.getWeeklyNoteSettings=G;y.getYearlyNote=Qt;y.getYearlyNoteSettings=J;function Ne(e,n,t){const i=e.slice();return i[15]=n[t],i}function Ee(e){let n;return{c(){n=C("div"),F(n,"class","dn-stock svelte-1n2mcl9")},m(t,i){W(t,n,i)},d(t){t&&A(n)}}}function De(e){let n,t,i;return{c(){n=C("div"),n.innerHTML='<div class="dn-blank-day-text svelte-1n2mcl9">Create a daily note for today \u270D</div>',F(n,"class","dn-blank-day svelte-1n2mcl9"),F(n,"aria-hidden","true")},m(o,r){W(o,n,r),t||(i=V(n,"click",e[5]),t=!0)},p:I,d(o){o&&A(n),t=!1,i()}}}function Se(e,n){let t,i,o;return i=new Dt({props:{file:n[15],plugin:n[0],leaf:n[1]}}),{key:e,first:null,c(){t=rt(),gt(i.$$.fragment),this.first=t},m(r,s){W(r,t,s),Ie(i,r,s),o=!0},p(r,s){n=r;const a={};s&8&&(a.file=n[15]),s&1&&(a.plugin=n[0]),s&2&&(a.leaf=n[1]),i.$set(a)},i(r){o||(ae(i.$$.fragment,r),o=!0)},o(r){we(i.$$.fragment,r),o=!1},d(r){r&&A(t),He(i,r)}}}function Fe(e){let n;return{c(){n=C("div"),n.textContent="\u2014\u2014 No more of results \u2014\u2014",F(n,"class","no-more-text svelte-1n2mcl9")},m(t,i){W(t,n,i)},d(t){t&&A(n)}}}function tn(e){let n,t,i,o=[],r=new Map,s,a,h,l,d,f,u=e[3].length===0&&Ee(),m=!e[4]&&De(e),v=e[3];const _=c=>c[15];for(let c=0;c<v.length;c+=1){let p=Ne(e,v,c),k=_(p);r.set(k,o[c]=Se(k,p))}let w=!e[2]&&Fe();return{c(){n=C("div"),u&&u.c(),t=Y(),m&&m.c(),i=Y();for(let c=0;c<o.length;c+=1)o[c].c();s=Y(),a=C("div"),h=Y(),w&&w.c(),F(n,"class","daily-note-view")},m(c,p){W(c,n,p),u&&u.m(n,null),P(n,t),m&&m.m(n,null),P(n,i);for(let k=0;k<o.length;k+=1)o[k].m(n,null);P(n,s),P(n,a),P(n,h),w&&w.m(n,null),l=!0,d||(f=[Ae(Re.call(null,a,{})),V(a,"init",e[6]),V(a,"change",e[6])],d=!0)},p(c,[p]){c[3].length===0?u||(u=Ee(),u.c(),u.m(n,t)):u&&(u.d(1),u=null),c[4]?m&&(m.d(1),m=null):m?m.p(c,p):(m=De(c),m.c(),m.m(n,i)),p&11&&(v=c[3],ut(),o=pt(o,p,_,1,c,v,r,n,ht,Se,s,Ne),ft()),c[2]?w&&(w.d(1),w=null):w||(w=Fe(),w.c(),w.m(n,null))},i(c){if(!l){for(let p=0;p<v.length;p+=1)ae(o[p]);l=!0}},o(c){for(let p=0;p<o.length;p+=1)we(o[p]);l=!1},d(c){c&&A(n),u&&u.d(),m&&m.d();for(let p=0;p<o.length;p+=1)o[p].d();w&&w.d(),d=!1,H(f)}}}let nn=1;function on(e,n,t){let{plugin:i}=n,{leaf:o}=n,r,s=[],a=[],h=!0,l=!1,d=!0;function f(){const p=g.moment();en(p,r)||t(4,d=!1)}function u(){return wt(this,void 0,void 0,function*(){const p=g.moment();if(!d){const k=yield Jt(p);k instanceof g.TFile&&a.push(k),t(3,a=a.sort((T,O)=>parseInt(g.moment(O.basename).format("x"))-parseInt(g.moment(T.basename).format("x")))),t(4,d=!0)}})}function m(){!l||!h||(s.length===0&&l?t(2,h=!1):t(3,a=[...a,...s.splice(0,nn)]))}function v(){t(3,a)}function _(){f()}function w(p){if(!be(p,"day"))return;if(a.length===0){s.push(p),t(12,s=s.sort((D,L)=>parseInt(g.moment(L.basename).format("x"))-parseInt(g.moment(D.basename).format("x"))));return}const k=a[a.length-1],T=a[0],O=g.moment(k.basename),E=g.moment(T.basename),S=g.moment(p.basename);S.isBetween(O,E)?(a.push(p),t(3,a=a.sort((D,L)=>parseInt(g.moment(L.basename).format("x"))-parseInt(g.moment(D.basename).format("x"))))):S.isBefore(O)?(s.push(p),t(12,s=s.sort((D,L)=>parseInt(g.moment(L.basename).format("x"))-parseInt(g.moment(D.basename).format("x"))))):S.isAfter(E)&&(a.push(p),t(3,a=a.sort((D,L)=>parseInt(g.moment(L.basename).format("x"))-parseInt(g.moment(D.basename).format("x"))))),S.isSame(g.moment(),"day")&&t(4,d=!0)}function c(p){!be(p,"day")||(t(3,a=a.filter(k=>k.basename!==p.basename)),t(12,s=s.filter(k=>k.basename!==p.basename)),f())}return e.$$set=p=>{"plugin"in p&&t(0,i=p.plugin),"leaf"in p&&t(1,o=p.leaf)},e.$$.update=()=>{if(e.$$.dirty&14340&&h&&!l){t(11,r=Xt());for(const p in r)s.push(r[p]);t(13,l=!0),f()}},[i,o,h,a,d,u,m,v,_,w,c,r,s,l]}class rn extends Ye{constructor(n){super(),We(this,n,on,tn,Oe,{plugin:0,leaf:1,tick:7,check:8,fileCreate:9,fileDelete:10})}get tick(){return this.$$.ctx[7]}get check(){return this.$$.ctx[8]}get fileCreate(){return this.$$.ctx[9]}get fileDelete(){return this.$$.ctx[10]}}function ie(e,n){const t=Object.keys(n).map(i=>sn(e,i,n[i]));return t.length===1?t[0]:function(){t.forEach(i=>i())}}function sn(e,n,t){const i=e[n],o=e.hasOwnProperty(n);let r=t(i);return i&&Object.setPrototypeOf(r,i),Object.setPrototypeOf(s,r),e[n]=s,a;function s(...h){return r===i&&e[n]===s&&a(),r.apply(this,h)}function a(){e[n]===s&&(o?e[n]=i:delete e[n]),r!==i&&(r=i,Object.setPrototypeOf(s,i||Function))}}const an=()=>{g.addIcon("daily-note",'<svg width="103" height="134" viewBox="0 0 103 134" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M60.3446 21.848H22.5577C19.5764 21.848 17.1595 24.2648 17.1595 27.2462V65.0331C17.1595 68.0144 19.5764 70.4312 22.5577 70.4312H60.3446C63.3259 70.4312 65.7428 68.0144 65.7428 65.0331V27.2462C65.7428 24.2648 63.3259 21.848 60.3446 21.848Z" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M52.2476 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M30.655 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.1595 38.0424H65.7428" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M33.3541 54.2366L38.7523 59.6348L49.5485 48.8385" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><g filter="url(#filter0_ddddd_104_2)"><path d="M12.181 103.617L9.21851 95.8213L27.9292 87.0896L66.754 71.4973L93.1049 88.8047L91.3898 103.617H12.181Z" fill="#AC4DD9" stroke="black" stroke-width="0.963236"/><path d="M12.181 103.617L9.21851 95.9771L27.9292 87.0895L32.6069 103.461L12.181 103.617Z" fill="#540D75" stroke="black" stroke-width="0.963236"/><path d="M9.0625 95.6652L25.7894 67.212L27.9291 87.0894L9.21842 95.977L9.0625 95.6652Z" fill="#470068" stroke="black" stroke-width="0.481618"/><path d="M27.9291 87.0896L25.9021 66.8197L67.5335 56.2169L66.5979 71.4973L27.9291 87.0896Z" fill="#732E94" stroke="black" stroke-width="0.963236"/><path d="M66.598 71.4971L67.9466 56.3527L93.1049 88.8045L66.598 71.4971Z" fill="#C279E4" stroke="black" stroke-width="0.481618"/><path d="M9.0625 95.6652L25.7462 66.8195L67.9465 56.0808L93.1049 88.8046L66.598 71.4972L27.9291 87.0895L9.21842 95.9771L9.0625 95.6652Z" stroke="black" stroke-width="0.963236"/><path d="M26.0579 103.617L27.9289 87.0895L32.7625 103.617H26.0579Z" fill="#61018E" stroke="black" stroke-width="0.963236"/></g><defs><filter id="filter0_ddddd_104_2" x="0.0874329" y="53.8502" width="101.958" height="79.8707" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="1.20405"/><feGaussianBlur stdDeviation="1.44485"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="effect1_dropShadow_104_2" result="effect2_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="5.2978"/><feGaussianBlur stdDeviation="2.6489"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"/><feBlend mode="normal" in2="effect2_dropShadow_104_2" result="effect3_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="11.7996"/><feGaussianBlur stdDeviation="3.61213"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"/><feBlend mode="normal" in2="effect3_dropShadow_104_2" result="effect4_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="21.1912"/><feGaussianBlur stdDeviation="4.21416"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.01 0"/><feBlend mode="normal" in2="effect4_dropShadow_104_2" result="effect5_dropShadow_104_2"/><feBlend mode="normal" in="SourceGraphic" in2="effect5_dropShadow_104_2" result="shape"/></filter></defs></svg>')},R="daily-note-editor-view";class ln extends g.ItemView{constructor(t,i){super(t);b(this,"view");b(this,"plugin");b(this,"onFileCreate",t=>{t instanceof g.TFile&&this.view.fileCreate(t)});b(this,"onFileDelete",t=>{t instanceof g.TFile&&this.view.fileDelete(t)});this.plugin=i}getViewType(){return R}getDisplayText(){return"Daily Note"}getIcon(){return"daily-note"}async onOpen(){this.view=new rn({target:this.contentEl,props:{plugin:this.plugin,leaf:this.leaf}}),this.app.vault.on("create",this.onFileCreate),this.app.vault.on("delete",this.onFileDelete),this.app.workspace.onLayoutReady(this.view.tick.bind(this)),this.registerInterval(window.setInterval(async()=>{this.view.check()},1e3*60*60))}}class cn extends g.Plugin{constructor(){super(...arguments);b(this,"view");b(this,"lastActiveFile")}async onload(){this.patchWorkspace(),this.patchWorkspaceLeaf(),an(),this.registerView(R,t=>this.view=new ln(t,this)),this.addRibbonIcon("daily-note","Open Daily Note Editor",t=>this.openDailyNoteEditor()),this.addCommand({id:"open-daily-note-editor",name:"Open Daily Note Editor",callback:()=>this.openDailyNoteEditor()})}onunload(){this.app.workspace.detachLeavesOfType(R)}async openDailyNoteEditor(){const t=this.app.workspace;t.detachLeavesOfType(R);const i=t.getLeaf(!0);await i.setViewState({type:R}),t.revealLeaf(i)}patchWorkspace(){let t=!1;const i=ie(g.Workspace.prototype,{changeLayout(o){return async function(r){t=!0;try{await o.call(this,r)}finally{t=!1}}},iterateLeaves(o){return function(r,s){if(o.call(this,r,s))return!0;const a=typeof r=="function"?r:s,h=typeof r=="function"?s:r;if(!h||t)return!1;if(h===app.workspace.rootSplit||g.WorkspaceContainer&&h instanceof g.WorkspaceContainer){for(const l of z.popoversForWindow(h.win))if(o.call(this,a,l.rootSplit))return!0}return!1}},onDragLeaf(o){return function(r,s){return o.call(this,r,s)}}});this.register(i)}patchWorkspaceLeaf(){this.register(ie(g.WorkspaceLeaf.prototype,{getRoot(t){return function(){const i=t.call(this);return(i==null?void 0:i.getRoot)===this.getRoot?i:i==null?void 0:i.getRoot()}},setPinned(t){return function(i){t.call(this,i),_e(this)&&!i&&this.setPinned(!0)}},openFile(t){return function(i,o){if(_e(this)){setTimeout(ie(g.Workspace.prototype,{recordMostRecentOpenedFile(s){return function(a){if(a!==i)return s.call(this,a)}}}),1);const r=this.app.plugins.plugins["recent-files-obsidian"];r&&setTimeout(ie(r,{shouldAddFile(s){return function(a){return a!==i&&s.call(this,a)}}}),1)}return t.call(this,i,o)}}}))}}exports.DAILY_NOTE_VIEW_TYPE=R;exports.default=cn;
